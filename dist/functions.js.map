{"version":3,"sources":["webpack:///functions.js","webpack:///webpack/bootstrap 808c2a6c18e953c4daac","webpack:///./src/Data/Model.ts","webpack:///./src/messages.ts","webpack:///./src/functions.ts","webpack:///./src/Data/Factory.ts","webpack:///./src/Data/RESTData.ts","webpack:///./src/Data/EWSData.ts"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","10","value","Data","removeDuplicates","results","itemId","excludedFolderIds","item_1","filter","item","message","Id","pop","console","log","length","sameFolderItems_1","result","ParentFolderId","folder","reduce","previousValue","currentValue","Sender","ToRecipients","BodyPreview","Progress","168","DialogMessages","saveDialog","storedResults","window","localStorage","setItem","storageKey","JSON","stringify","loadDialog","parse","getItem","resetDialog","removeItem","218","ButtonFunctions","messages_1","Model_1","Factory_1","getDialogUrl","location","href","replace","functionsRegex","getAboutUrl","fileDialog","event","mailbox","Office","context","data","Factory","getData","notificationKey","getItemsAsync","notificationMessages","replaceAsync","type","MailboxEnums","ItemNotificationMessageType","InformationalMessage","icon","persistent","completed","removeAsync","ui","displayDialogAsync","height","width","displayInIframe","dialog","onDialogComplete","addEventHandler","EventType","DialogMessageReceived","dialogEvent","canceled","close","ProgressIndicator","moveItemsAsync","folderId","count","ErrorMessage","DialogEventReceived","progress","aboutDialog","sendFeedback","displayNewMessageForm","toRecipients","subject","initialize","63","RESTData_1","EWSData_1","restUrl","RESTData","Model","EWSData","64","ExcludedFolders","Context","this","getRestId","loadItems","onLoadComplete","onProgress","onError","_this","GetCallbackToken","getCallbackTokenAsync","isRest","status","AsyncResultStatus","Succeeded","getConversation","error","collateRequests","requests","onDone","onFail","$","when","apply","done","_i","arguments","map","fail","request","diagnostics","hostName","convertToRestId","RestVersion","v2_0","token","conversationId","restConversationId","GetConversation","ajax","url","async","dataType","headers","Authorization","getExcludedFolders","conversationMessages","currentFolderId","undefined","Count","push","GetExcludedFolders","getFolderNames","folderMap","entry","messages","GetFolderNames","forEach","DisplayName","messageCount","folderCount","matches","concat","EmailAddress","Name","address","join","moveItems","onMoveComplete","method","contentType","DestinationId","65","RequestBuilder","getItemsRequest","builder","beginRequest","id","changeKey","endRequest","getFolderNamesRequest","folders","moveItemsRequest","findConversationRequest","excludedFolderIdsRequest","makeEwsRequestAsync","conversationXml","parseXML","$conversation","querySelectorAll","parents","parseInt","find","text","sameFolderItemIds","each","$this","attr","otherFolderItemIds","conversation","items","global","loadExcludedFolders","excludedFolders","loadMessages","foldersXml","itemsXml","getMessages","$messages","parent","msg","querySelector","getAttribute","from","textContent","to","body","slice","loadFolderDisplayNames","folderNamesXml","getFolderDisplayNames","destinations_1","parentNode","displayName"],"mappings":"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","file":"functions.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 218);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 10:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Data;\r\n(function (Data) {\r\n    var Progress;\r\n    (function (Progress) {\r\n        Progress[Progress[\"GetCallbackToken\"] = 0] = \"GetCallbackToken\";\r\n        Progress[Progress[\"GetConversation\"] = 1] = \"GetConversation\";\r\n        Progress[Progress[\"GetExcludedFolders\"] = 2] = \"GetExcludedFolders\";\r\n        Progress[Progress[\"GetFolderNames\"] = 3] = \"GetFolderNames\";\r\n        Progress[Progress[\"Success\"] = 4] = \"Success\";\r\n        Progress[Progress[\"NotFound\"] = 5] = \"NotFound\";\r\n        Progress[Progress[\"Error\"] = 6] = \"Error\";\r\n    })(Progress = Data.Progress || (Data.Progress = {}));\r\n    function removeDuplicates(results, itemId, excludedFolderIds) {\r\n        if (itemId) {\r\n            var item_1 = results\r\n                .filter(function (item) { return item.message.Id === itemId; })\r\n                .pop();\r\n            if (item_1) {\r\n                console.log(\"Removing duplicates: \" + results.length + \" original message(s)\");\r\n                // Find all of the items in the same folder, we want to remove all of their duplicates.\r\n                var sameFolderItems_1 = results.filter(function (result) { return result.message.ParentFolderId === item_1.message.ParentFolderId; });\r\n                console.log(\"Messages in the same folder: \" + sameFolderItems_1.length + \" message(s)\");\r\n                // Remove all items that are in the same folder.\r\n                results = results.filter(function (result) {\r\n                    if (result.folder.Id === item_1.message.ParentFolderId) {\r\n                        console.log(\"Removed message in the same folder: \" + result.message.Id);\r\n                        return false;\r\n                    }\r\n                    else {\r\n                        return true;\r\n                    }\r\n                });\r\n                // Remove all items that are in another excluded folder.\r\n                results = results.filter(function (result) {\r\n                    if (excludedFolderIds.reduce(function (previousValue, currentValue) { return previousValue || currentValue === result.folder.Id; }, false)) {\r\n                        console.log(\"Removed message in an excluded folder: \" + result.message.Id);\r\n                        return false;\r\n                    }\r\n                    else {\r\n                        return true;\r\n                    }\r\n                });\r\n                // Remove all items that match an item in the same folder.\r\n                results = results.filter(function (result) {\r\n                    if (sameFolderItems_1.reduce(function (previousValue, value) { return previousValue ||\r\n                        (result.message.Sender === value.message.Sender &&\r\n                            result.message.ToRecipients === value.message.ToRecipients &&\r\n                            result.message.BodyPreview === value.message.BodyPreview); }, false)) {\r\n                        console.log(\"Removed duplicate message in other folder: \" + item_1.message.Id);\r\n                        return false;\r\n                    }\r\n                    else {\r\n                        return true;\r\n                    }\r\n                });\r\n                console.log(\"Remaining in other folders: \" + results.length + \" distinct message(s)\");\r\n            }\r\n        }\r\n        return results;\r\n    }\r\n    Data.removeDuplicates = removeDuplicates;\r\n})(Data = exports.Data || (exports.Data = {}));\r\n\n\n/***/ }),\n\n/***/ 168:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar DialogMessages;\r\n(function (DialogMessages) {\r\n    var storageKey = \"conversationFilerMatches\";\r\n    function saveDialog(storedResults) {\r\n        window.localStorage.setItem(storageKey, JSON.stringify(storedResults));\r\n    }\r\n    DialogMessages.saveDialog = saveDialog;\r\n    function loadDialog() {\r\n        return JSON.parse(window.localStorage.getItem(storageKey));\r\n    }\r\n    DialogMessages.loadDialog = loadDialog;\r\n    function resetDialog() {\r\n        window.localStorage.removeItem(storageKey);\r\n    }\r\n    DialogMessages.resetDialog = resetDialog;\r\n})(DialogMessages = exports.DialogMessages || (exports.DialogMessages = {}));\r\n\n\n/***/ }),\n\n/***/ 218:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar messages_1 = __webpack_require__(168);\r\nvar Model_1 = __webpack_require__(10);\r\nvar Factory_1 = __webpack_require__(63);\r\nvar ButtonFunctions;\r\n(function (ButtonFunctions) {\r\n    var functionsRegex = /\\/functions\\.html(\\?.*)?$/i;\r\n    function getDialogUrl() {\r\n        return window.location.href.replace(functionsRegex, \"/dialog.html\");\r\n    }\r\n    function getAboutUrl() {\r\n        return window.location.href.replace(functionsRegex, \"/about.html\");\r\n    }\r\n    function fileDialog(event) {\r\n        var mailbox = Office.context.mailbox;\r\n        var data = Factory_1.Factory.getData(mailbox);\r\n        var notificationKey = 'conversationFilerNotification';\r\n        console.log('Starting to load the conversation...');\r\n        data.getItemsAsync(function (results) {\r\n            console.log(\"Loaded the conversation: \" + results.length);\r\n            if (results.length === 0) {\r\n                // Special case for empty results\r\n                mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\r\n                    message: \"It looks like you haven't filed this conversation anywhere before.\",\r\n                    icon: 'file-icon-16',\r\n                    persistent: false\r\n                });\r\n                event.completed();\r\n                return;\r\n            }\r\n            console.log('Showing the dialog...');\r\n            mailbox.item.notificationMessages.removeAsync(notificationKey);\r\n            messages_1.DialogMessages.saveDialog(results);\r\n            Office.context.ui.displayDialogAsync(getDialogUrl(), { height: 40, width: 50, displayInIframe: true }, function (result) {\r\n                var dialog = result.value;\r\n                var onDialogComplete = function () {\r\n                    messages_1.DialogMessages.resetDialog();\r\n                    event.completed();\r\n                };\r\n                dialog.addEventHandler(Office.EventType.DialogMessageReceived, function (dialogEvent) {\r\n                    var message = JSON.parse(dialogEvent.message);\r\n                    if (message.canceled) {\r\n                        console.log('Dialog canceled');\r\n                        dialog.close();\r\n                        onDialogComplete();\r\n                        return;\r\n                    }\r\n                    console.log('Moving the items...');\r\n                    dialog.close();\r\n                    mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                        type: Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,\r\n                        message: 'Moving the items in this conversation...'\r\n                    });\r\n                    data.moveItemsAsync(message.folderId, function (count) {\r\n                        console.log(\"Finished moving the items: \" + count);\r\n                        mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                            type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\r\n                            message: 'I moved the items in this conversation, but there might be a short delay before that shows up in Outlook.',\r\n                            icon: 'file-icon-16',\r\n                            persistent: false\r\n                        });\r\n                        onDialogComplete();\r\n                    }, function (message) {\r\n                        console.log(\"Error moving the items: \" + message);\r\n                        mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                            type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n                            message: \"Something went wrong, I couldn't move the messages.\"\r\n                        });\r\n                        onDialogComplete();\r\n                    });\r\n                });\r\n                dialog.addEventHandler(Office.EventType.DialogEventReceived, function () {\r\n                    onDialogComplete();\r\n                });\r\n            });\r\n        }, function (progress) {\r\n            console.log(\"Progress loading the conversation: \" + Model_1.Data.Progress[progress]);\r\n            // Update the progress indicator\r\n            mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                type: Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,\r\n                message: 'Finding the messages in this conversation...'\r\n            });\r\n        }, function (message) {\r\n            console.log(\"Error loading the conversation: \" + message);\r\n            // Display an error\r\n            mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n                message: \"Sorry, I couldn't figure out where this message should go.\"\r\n            });\r\n            event.completed();\r\n        });\r\n    }\r\n    ButtonFunctions.fileDialog = fileDialog;\r\n    function aboutDialog(event) {\r\n        Office.context.ui.displayDialogAsync(getAboutUrl(), { height: 40, width: 25, displayInIframe: true }, function (result) {\r\n            var dialog = result.value;\r\n            var onDialogComplete = function () {\r\n                event.completed();\r\n            };\r\n            dialog.addEventHandler(Office.EventType.DialogMessageReceived, function () {\r\n                console.log('Dialog closed with button');\r\n                dialog.close();\r\n                event.completed();\r\n            });\r\n            dialog.addEventHandler(Office.EventType.DialogEventReceived, function () {\r\n                console.log('Dialog closed');\r\n                event.completed();\r\n            });\r\n        });\r\n    }\r\n    ButtonFunctions.aboutDialog = aboutDialog;\r\n    function sendFeedback(event) {\r\n        Office.context.mailbox.displayNewMessageForm({\r\n            toRecipients: ['wravery@hotmail.com'],\r\n            subject: 'Conversation Filer v2.0 App for Outlook'\r\n        });\r\n        event.completed();\r\n    }\r\n    ButtonFunctions.sendFeedback = sendFeedback;\r\n})(ButtonFunctions || (ButtonFunctions = {}));\r\nOffice.initialize = function () {\r\n    // Add the UI-less function callbacks to the window\r\n    window.fileDialog = ButtonFunctions.fileDialog;\r\n    window.aboutDialog = ButtonFunctions.aboutDialog;\r\n    window.sendFeedback = ButtonFunctions.sendFeedback;\r\n};\r\n\n\n/***/ }),\n\n/***/ 63:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar RESTData_1 = __webpack_require__(64);\r\nvar EWSData_1 = __webpack_require__(65);\r\nvar Factory;\r\n(function (Factory) {\r\n    // Use the RESTData provider if possible, but if it's not supported, fallback to the EWSData provider\r\n    function getData(mailbox) {\r\n        return mailbox.restUrl\r\n            ? new RESTData_1.RESTData.Model(mailbox)\r\n            : new EWSData_1.EWSData.Model(mailbox);\r\n    }\r\n    Factory.getData = getData;\r\n})(Factory = exports.Factory || (exports.Factory = {}));\r\n\n\n/***/ }),\n\n/***/ 64:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Model_1 = __webpack_require__(10);\r\nvar RESTData;\r\n(function (RESTData) {\r\n    var Endpoint = '/v2.0/me';\r\n    var ExcludedFolders;\r\n    (function (ExcludedFolders) {\r\n        ExcludedFolders[ExcludedFolders[\"Inbox\"] = 0] = \"Inbox\";\r\n        ExcludedFolders[ExcludedFolders[\"Drafts\"] = 1] = \"Drafts\";\r\n        ExcludedFolders[ExcludedFolders[\"SentItems\"] = 2] = \"SentItems\";\r\n        ExcludedFolders[ExcludedFolders[\"DeletedItems\"] = 3] = \"DeletedItems\";\r\n        // Sentinel value for enumerating the folder names\r\n        ExcludedFolders[ExcludedFolders[\"Count\"] = 4] = \"Count\";\r\n    })(ExcludedFolders || (ExcludedFolders = {}));\r\n    var Context = /** @class */ (function () {\r\n        function Context(mailbox) {\r\n            this.mailbox = mailbox;\r\n            this.itemId = this.getRestId(this.mailbox.item.itemId);\r\n        }\r\n        Context.prototype.loadItems = function (onLoadComplete, onProgress, onError) {\r\n            var _this = this;\r\n            this.onLoadComplete = onLoadComplete;\r\n            this.onProgress = onProgress;\r\n            this.onError = onError;\r\n            console.log('Requesting the REST callback token...');\r\n            this.onProgress(Model_1.Data.Progress.GetCallbackToken);\r\n            // Start the chain of requests by getting a callback token.\r\n            this.mailbox.getCallbackTokenAsync({ isRest: true }, function (result) {\r\n                if (result.status === Office.AsyncResultStatus.Succeeded) {\r\n                    _this.getConversation(result);\r\n                }\r\n                else {\r\n                    _this.onError(result.error.message);\r\n                }\r\n            });\r\n        };\r\n        // Sometimes we need to make separate REST requests for multiple items. Wait until they all complete and then\r\n        // invoke the callbacks all at once with an array of typed results.\r\n        Context.prototype.collateRequests = function (requests, onDone, onFail) {\r\n            var _this = this;\r\n            if (requests.length > 1) {\r\n                $.when.apply($, requests)\r\n                    .done(function () {\r\n                    var results = [];\r\n                    for (var _i = 0; _i < arguments.length; _i++) {\r\n                        results[_i] = arguments[_i];\r\n                    }\r\n                    onDone(results.map(function (result) { return result[0]; }));\r\n                }).fail(function (request, status, message) {\r\n                    _this.onError(message);\r\n                });\r\n            }\r\n            else {\r\n                requests[0]\r\n                    .done(function (result) {\r\n                    onDone([result]);\r\n                }).fail(function (request, status, message) {\r\n                    _this.onError(message);\r\n                });\r\n            }\r\n        };\r\n        // If we're on iOS, the IDs we get from Office.context.mailbox.item are already REST IDs. Otherwise we need\r\n        // to convert them from the EWS ID format to the REST ID format.\r\n        Context.prototype.getRestId = function (itemId) {\r\n            if (this.mailbox.diagnostics.hostName === 'OutlookIOS') {\r\n                return itemId;\r\n            }\r\n            return this.mailbox.convertToRestId(itemId, Office.MailboxEnums.RestVersion.v2_0);\r\n        };\r\n        // Send a REST request to retrieve a list of messages in this conversation.\r\n        Context.prototype.getConversation = function (result) {\r\n            var _this = this;\r\n            this.token = result.value;\r\n            var conversationId = this.mailbox.item.conversationId;\r\n            var restConversationId = this.getRestId(conversationId);\r\n            var restUrl = \"\" + this.mailbox.restUrl + Endpoint + \"/messages?$filter=ConversationId eq '\" + restConversationId + \"'&$select=Id,Subject,BodyPreview,Sender,ToRecipients,ParentFolderId\";\r\n            console.log(\"Getting the list of items in the conversation: \" + restUrl);\r\n            this.onProgress(Model_1.Data.Progress.GetConversation);\r\n            $.ajax({\r\n                url: restUrl,\r\n                async: true,\r\n                dataType: 'json',\r\n                headers: { 'Authorization': \"Bearer \" + this.token }\r\n            }).done(function (result) {\r\n                _this.getExcludedFolders(result);\r\n            }).fail(function (request, status, message) {\r\n                _this.onError(message);\r\n            });\r\n        };\r\n        // Send a REST request to identify each of the folders we want to exclude in our results.\r\n        Context.prototype.getExcludedFolders = function (result) {\r\n            var _this = this;\r\n            if (!result || !result.value || 0 === result.value.length) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n            this.conversationMessages = result.value;\r\n            console.log(\"Messages in the conversation: \" + this.conversationMessages.length);\r\n            // Get the current folderId.\r\n            var currentFolderId = this.conversationMessages\r\n                .filter(function (value) { return value.Id === _this.itemId; })\r\n                .reduce(function (previousValue, value) { return value.ParentFolderId; }, undefined);\r\n            // We should exclude some special folders, but we need to get their folderIds.\r\n            var requests = [];\r\n            for (var i = 0; i < ExcludedFolders.Count; ++i) {\r\n                var folderId = ExcludedFolders[i];\r\n                var restUrl = \"\" + this.mailbox.restUrl + Endpoint + \"/mailfolders/\" + folderId + \"?$select=Id\";\r\n                console.log(\"Getting excluded folder ID: \" + restUrl);\r\n                requests.push($.ajax({\r\n                    url: restUrl,\r\n                    async: true,\r\n                    dataType: 'json',\r\n                    headers: { 'Authorization': \"Bearer \" + this.token }\r\n                }));\r\n            }\r\n            this.onProgress(Model_1.Data.Progress.GetExcludedFolders);\r\n            this.collateRequests(requests, function (results) {\r\n                var excludedFolderIds = results.map(function (value) { return value.Id; });\r\n                _this.getFolderNames(currentFolderId, excludedFolderIds);\r\n            }, function (message) {\r\n                _this.onError(message);\r\n            });\r\n        };\r\n        // Send REST requests to fill in the display names of all the folders we are not excluding.\r\n        Context.prototype.getFolderNames = function (currentFolderId, excludedFolderIds) {\r\n            var _this = this;\r\n            ;\r\n            var folderMap = this.conversationMessages\r\n                .reduce(function (previousValue, message) {\r\n                var entry = previousValue\r\n                    .filter(function (value) { return value.folder.Id === message.ParentFolderId; })\r\n                    .pop();\r\n                if (entry) {\r\n                    // Add this message to the existing entry.\r\n                    entry.messages.push(message);\r\n                }\r\n                else {\r\n                    // Create a new entry for this folder.\r\n                    previousValue.push({ folder: { Id: message.ParentFolderId }, messages: [message] });\r\n                }\r\n                return previousValue;\r\n            }, []);\r\n            this.currentFolderId = currentFolderId;\r\n            this.excludedFolderIds = excludedFolderIds;\r\n            var requests = folderMap\r\n                .filter(function (entry) { return !_this.excludedFolderIds.reduce(function (previousValue, value) {\r\n                return previousValue || value === entry.folder.Id;\r\n            }, false); })\r\n                .map(function (entry) {\r\n                var restUrl = \"\" + _this.mailbox.restUrl + Endpoint + \"/mailfolders/\" + entry.folder.Id + \"?$select=Id,DisplayName\";\r\n                console.log(\"Getting included folder name: \" + restUrl);\r\n                return $.ajax({\r\n                    url: restUrl,\r\n                    async: true,\r\n                    dataType: 'json',\r\n                    headers: { 'Authorization': \"Bearer \" + _this.token }\r\n                });\r\n            });\r\n            if (requests.length === 0) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n            this.onProgress(Model_1.Data.Progress.GetFolderNames);\r\n            this.collateRequests(requests, function (results) {\r\n                results.forEach(function (value) {\r\n                    for (var i = 0; i < folderMap.length; ++i) {\r\n                        if (folderMap[i].folder.Id === value.Id) {\r\n                            folderMap[i].folder.DisplayName = value.DisplayName;\r\n                            break;\r\n                        }\r\n                    }\r\n                });\r\n                var messageCount = folderMap.reduce(function (previousValue, currentValue) { return previousValue + currentValue.messages.length; }, 0);\r\n                var folderCount = folderMap.length;\r\n                console.log(\"Found \" + messageCount + \" message(s) in \" + folderCount + \" folder(s)\");\r\n                var matches = folderMap.reduce(function (previousValue, currentValue) {\r\n                    return previousValue.concat(currentValue.messages.map(function (item) { return ({\r\n                        message: {\r\n                            Id: item.Id,\r\n                            BodyPreview: item.BodyPreview,\r\n                            Sender: item.Sender.EmailAddress.Name,\r\n                            ToRecipients: item.ToRecipients.map(function (address) { return address.EmailAddress.Name; }).join('; '),\r\n                            ParentFolderId: item.ParentFolderId\r\n                        },\r\n                        folder: {\r\n                            Id: currentValue.folder.Id,\r\n                            DisplayName: currentValue.folder.DisplayName\r\n                        }\r\n                    }); }));\r\n                }, []);\r\n                console.log(\"Finished loading items: \" + matches.length);\r\n                _this.onLoadComplete(Model_1.Data.removeDuplicates(matches, _this.itemId, _this.excludedFolderIds));\r\n            }, function (message) {\r\n                _this.onError(message);\r\n            });\r\n        };\r\n        Context.prototype.moveItems = function (folderId, onMoveComplete, onError) {\r\n            var _this = this;\r\n            this.onMoveComplete = onMoveComplete;\r\n            this.onError = onError;\r\n            console.log(\"Moving items to folder: \" + folderId);\r\n            var requests = this.conversationMessages\r\n                .filter(function (message) { return message.ParentFolderId !== _this.currentFolderId; })\r\n                .map(function (message) {\r\n                var restUrl = \"\" + _this.mailbox.restUrl + Endpoint + \"/messages/\" + message.Id + \"/move\";\r\n                console.log(\"Moving item: \" + restUrl);\r\n                return $.ajax({\r\n                    url: restUrl,\r\n                    async: true,\r\n                    method: 'POST',\r\n                    contentType: 'application/json',\r\n                    dataType: 'json',\r\n                    data: JSON.stringify({ DestinationId: folderId }),\r\n                    headers: { 'Authorization': \"Bearer \" + _this.token }\r\n                });\r\n            });\r\n            this.collateRequests(requests, function (results) {\r\n                console.log(\"Finished moving items to other folder: \" + results.length);\r\n                _this.onMoveComplete(results.length);\r\n            }, function (message) {\r\n                _this.onError(message);\r\n            });\r\n        };\r\n        return Context;\r\n    }());\r\n    var Model = /** @class */ (function () {\r\n        function Model(mailbox) {\r\n            this.context = new Context(mailbox);\r\n        }\r\n        Model.prototype.getItemsAsync = function (onLoadComplete, onProgress, onError) {\r\n            this.context.loadItems(onLoadComplete, onProgress, onError);\r\n        };\r\n        Model.prototype.moveItemsAsync = function (folderId, onMoveComplete, onError) {\r\n            this.context.moveItems(folderId, onMoveComplete, onError);\r\n        };\r\n        return Model;\r\n    }());\r\n    RESTData.Model = Model;\r\n})(RESTData = exports.RESTData || (exports.RESTData = {}));\r\n\n\n/***/ }),\n\n/***/ 65:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Model_1 = __webpack_require__(10);\r\nvar EWSData;\r\n(function (EWSData) {\r\n    var RequestBuilder = /** @class */ (function () {\r\n        function RequestBuilder() {\r\n        }\r\n        RequestBuilder.getItemsRequest = function (messages) {\r\n            var builder = [\r\n                RequestBuilder.beginRequest,\r\n                '  <m:GetItem>',\r\n                '    <m:ItemShape>',\r\n                '      <t:BaseShape>IdOnly</t:BaseShape>',\r\n                '      <t:BodyType>Text</t:BodyType>',\r\n                '      <t:AdditionalProperties>',\r\n                '        <t:FieldURI FieldURI=\"item:ParentFolderId\" />',\r\n                '        <t:FieldURI FieldURI=\"message:Sender\" />',\r\n                '        <t:FieldURI FieldURI=\"message:ToRecipients\" />',\r\n                '        <t:FieldURI FieldURI=\"item:Body\" />',\r\n                '      </t:AdditionalProperties>',\r\n                '    </m:ItemShape>',\r\n                '    <m:ItemIds>',\r\n            ];\r\n            messages.map(function (message) {\r\n                builder.push(\"      <t:ItemId Id=\\\"\" + message.itemId.id + \"\\\" ChangeKey=\\\"\" + message.itemId.changeKey + \"\\\" />\");\r\n            });\r\n            builder.push('    </m:ItemIds>', '  </m:GetItem>', RequestBuilder.endRequest);\r\n            return builder.join('\\n');\r\n        };\r\n        RequestBuilder.getFolderNamesRequest = function (folders) {\r\n            var builder = [\r\n                RequestBuilder.beginRequest,\r\n                '  <m:GetFolder>',\r\n                '    <m:FolderShape>',\r\n                '      <t:BaseShape>IdOnly</t:BaseShape>',\r\n                '      <t:AdditionalProperties>',\r\n                '        <t:FieldURI FieldURI=\"folder:DisplayName\" />',\r\n                '      </t:AdditionalProperties>',\r\n                '    </m:FolderShape>',\r\n                '    <m:FolderIds>'\r\n            ];\r\n            folders.map(function (folder) {\r\n                builder.push(\"      <t:FolderId Id=\\\"\" + folder.folderId.id + \"\\\" ChangeKey=\\\"\" + folder.folderId.changeKey + \"\\\" />\");\r\n            });\r\n            builder.push('    </m:FolderIds>', '  </m:GetFolder >', RequestBuilder.endRequest);\r\n            return builder.join('\\n');\r\n        };\r\n        RequestBuilder.moveItemsRequest = function (messages, folderId) {\r\n            var builder = [\r\n                RequestBuilder.beginRequest,\r\n                '  <m:MoveItem>',\r\n                '    <m:ToFolderId>',\r\n                '      <t:FolderId Id=\"' + folderId + '\"/>',\r\n                '    </m:ToFolderId>',\r\n                '    <m:ItemIds>',\r\n            ];\r\n            messages.map(function (message) {\r\n                builder.push(\"      <t:ItemId Id=\\\"\" + message.itemId.id + \"\\\" ChangeKey=\\\"\" + message.itemId.changeKey + \"\\\" />\");\r\n            });\r\n            builder.push('    </m:ItemIds>', '  </m:MoveItem>', RequestBuilder.endRequest);\r\n            return builder.join('\\n');\r\n        };\r\n        RequestBuilder.beginRequest = [\r\n            '<?xml version=\"1.0\" encoding=\"utf-8\" ?>',\r\n            '<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"',\r\n            '    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"',\r\n            '    xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"',\r\n            '    xmlns:t=\"http://schemas.microsoft.com/exchange/services/2006/types\"',\r\n            '    xmlns:m=\"http://schemas.microsoft.com/exchange/services/2006/messages\">',\r\n            '<soap:Header>',\r\n            '  <t:RequestServerVersion Version=\"Exchange2010_SP1\" />',\r\n            '</soap:Header>',\r\n            '<soap:Body>',\r\n        ].join('\\n');\r\n        RequestBuilder.endRequest = [\r\n            '</soap:Body>',\r\n            '</soap:Envelope>'\r\n        ].join('\\n');\r\n        RequestBuilder.findConversationRequest = [\r\n            RequestBuilder.beginRequest,\r\n            '  <m:FindConversation>',\r\n            '    <m:IndexedPageItemView BasePoint=\"Beginning\" Offset=\"0\" MaxEntriesReturned=\"20\" />',\r\n            '    <m:ParentFolderId>',\r\n            '      <t:DistinguishedFolderId Id=\"inbox\"/>',\r\n            '    </m:ParentFolderId>',\r\n            '  </m:FindConversation>',\r\n            RequestBuilder.endRequest\r\n        ].join('\\n');\r\n        RequestBuilder.excludedFolderIdsRequest = [\r\n            RequestBuilder.beginRequest,\r\n            '  <m:GetFolder>',\r\n            '    <m:FolderShape>',\r\n            '      <t:BaseShape>IdOnly</t:BaseShape>',\r\n            '    </m:FolderShape>',\r\n            '    <m:FolderIds>',\r\n            '      <t:DistinguishedFolderId Id=\"inbox\"/>',\r\n            '      <t:DistinguishedFolderId Id=\"drafts\"/>',\r\n            '      <t:DistinguishedFolderId Id=\"sentitems\"/>',\r\n            '      <t:DistinguishedFolderId Id=\"deleteditems\"/>',\r\n            '    </m:FolderIds>',\r\n            '  </m:GetFolder >',\r\n            RequestBuilder.endRequest\r\n        ].join('\\n');\r\n        return RequestBuilder;\r\n    }());\r\n    var Context = /** @class */ (function () {\r\n        function Context(mailbox) {\r\n            this.mailbox = mailbox;\r\n            this.itemId = this.mailbox.item.itemId;\r\n        }\r\n        Context.prototype.loadItems = function (onLoadComplete, onProgress, onError) {\r\n            var _this = this;\r\n            this.onLoadComplete = onLoadComplete;\r\n            this.onProgress = onProgress;\r\n            this.onError = onError;\r\n            console.log('Finding the conversation with EWS...');\r\n            this.onProgress(Model_1.Data.Progress.GetConversation);\r\n            this.mailbox.makeEwsRequestAsync(RequestBuilder.findConversationRequest, function (result) {\r\n                if (!result.value) {\r\n                    _this.onError(result.error.message);\r\n                    return;\r\n                }\r\n                _this.conversationXml = $.parseXML(result.value);\r\n                _this.getConversation();\r\n            });\r\n        };\r\n        Context.prototype.getConversation = function () {\r\n            var _this = this;\r\n            var $conversation = $(this.conversationXml.querySelectorAll('Conversation > GlobalItemIds > ItemId'))\r\n                .filter(\"[Id=\\\"\" + this.mailbox.item.itemId + \"\\\"]\")\r\n                .parents('Conversation');\r\n            if (!$conversation.length) {\r\n                this.onError(\"This conversation isn't in your inbox's top 20.\");\r\n                return;\r\n            }\r\n            var messageCount = parseInt($conversation.find('MessageCount').text());\r\n            var globalCount = parseInt($conversation.find('GlobalMessageCount').text());\r\n            if (messageCount >= globalCount) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n            var sameFolderItemIds = [];\r\n            $conversation.find('ItemIds > ItemId').each(function () {\r\n                var $this = $(this);\r\n                sameFolderItemIds.push({\r\n                    id: $this.attr('Id'),\r\n                    changeKey: $this.attr('ChangeKey')\r\n                });\r\n            });\r\n            var otherFolderItemIds = [];\r\n            $conversation.find('GlobalItemIds > ItemId').each(function () {\r\n                var $this = $(this);\r\n                otherFolderItemIds.push({\r\n                    id: $this.attr('Id'),\r\n                    changeKey: $this.attr('ChangeKey')\r\n                });\r\n            });\r\n            if (!sameFolderItemIds.length || otherFolderItemIds.length <= sameFolderItemIds.length) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n            this.conversation = {\r\n                id: this.mailbox.item.conversationId,\r\n                items: sameFolderItemIds.map(function (itemId) { return ({ itemId: itemId, conversation: _this.conversation }); }),\r\n                global: otherFolderItemIds.map(function (itemId) { return ({ itemId: itemId, conversation: _this.conversation }); })\r\n            };\r\n            this.loadExcludedFolders();\r\n        };\r\n        Context.prototype.loadExcludedFolders = function () {\r\n            var _this = this;\r\n            if (this.excludedFolders) {\r\n                this.loadMessages();\r\n            }\r\n            else {\r\n                console.log('Getting the list of excluded folders');\r\n                this.onProgress(Model_1.Data.Progress.GetExcludedFolders);\r\n                this.mailbox.makeEwsRequestAsync(RequestBuilder.excludedFolderIdsRequest, function (result) {\r\n                    if (!result.value) {\r\n                        _this.onError(result.error.message);\r\n                        return;\r\n                    }\r\n                    var foldersXml = $.parseXML(result.value);\r\n                    var excludedFolders = [];\r\n                    $(foldersXml.querySelectorAll('GetFolderResponseMessage > Folders > Folder > FolderId')).each(function () {\r\n                        var $this = $(this);\r\n                        excludedFolders.push({\r\n                            folderId: {\r\n                                id: $this.attr('Id'),\r\n                                changeKey: $this.attr('ChangeKey')\r\n                            }\r\n                        });\r\n                    });\r\n                    _this.excludedFolders = excludedFolders;\r\n                    _this.loadMessages();\r\n                });\r\n            }\r\n        };\r\n        Context.prototype.loadMessages = function () {\r\n            var _this = this;\r\n            if (this.itemsXml) {\r\n                this.getMessages();\r\n            }\r\n            else {\r\n                console.log(\"Getting the messages in other folders: \" + this.conversation.global.length);\r\n                this.onProgress(Model_1.Data.Progress.GetConversation);\r\n                this.mailbox.makeEwsRequestAsync(RequestBuilder.getItemsRequest(this.conversation.global), function (result) {\r\n                    if (!result.value) {\r\n                        _this.onError(result.error.message);\r\n                        return;\r\n                    }\r\n                    _this.itemsXml = $.parseXML(result.value);\r\n                    _this.getMessages();\r\n                });\r\n            }\r\n        };\r\n        Context.prototype.getMessages = function () {\r\n            var $messages = $(this.itemsXml.querySelectorAll('GetItemResponseMessage > Items > Message > ParentFolderId'))\r\n                .parent();\r\n            this.conversation.global.map(function (item) {\r\n                for (var i = 0; i < $messages.length; i++) {\r\n                    var msg = $messages[i];\r\n                    if (msg.querySelector(\"ItemId[Id=\\\"\" + item.itemId.id + \"\\\"]\")) {\r\n                        var folderId = msg.querySelector('ParentFolderId');\r\n                        item.folder = {\r\n                            folderId: {\r\n                                id: folderId.getAttribute('Id'),\r\n                                changeKey: folderId.getAttribute('ChangeKey')\r\n                            }\r\n                        };\r\n                        item.from = msg.querySelector('Sender > Mailbox > Name').textContent;\r\n                        item.to = msg.querySelector('ToRecipients > Mailbox > Name').textContent;\r\n                        item.body = msg.querySelector('Body').textContent.slice(0, 200);\r\n                        break;\r\n                    }\r\n                }\r\n            });\r\n            this.loadFolderDisplayNames();\r\n        };\r\n        Context.prototype.loadFolderDisplayNames = function () {\r\n            var _this = this;\r\n            if (this.folderNamesXml) {\r\n                this.getFolderDisplayNames();\r\n            }\r\n            else {\r\n                var destinations_1 = [];\r\n                this.conversation.global.map(function (item) {\r\n                    if (item.folder) {\r\n                        destinations_1.push(item.folder);\r\n                    }\r\n                });\r\n                if (!destinations_1.length) {\r\n                    this.onLoadComplete([]);\r\n                    return;\r\n                }\r\n                console.log(\"Getting the display names of the other folders: \" + destinations_1.length);\r\n                this.onProgress(Model_1.Data.Progress.GetFolderNames);\r\n                this.mailbox.makeEwsRequestAsync(RequestBuilder.getFolderNamesRequest(destinations_1), function (result) {\r\n                    if (!result.value) {\r\n                        _this.onError(result.error.message);\r\n                        return;\r\n                    }\r\n                    _this.folderNamesXml = $.parseXML(result.value);\r\n                    _this.getFolderDisplayNames();\r\n                });\r\n            }\r\n        };\r\n        Context.prototype.getFolderDisplayNames = function () {\r\n            var _this = this;\r\n            var matches = [];\r\n            this.conversation.global.map(function (item) {\r\n                if (!item.folder) {\r\n                    return;\r\n                }\r\n                var folder = _this.folderNamesXml.querySelector(\"GetFolderResponseMessage > Folders > Folder > FolderId[Id=\\\"\" + item.folder.folderId.id + \"\\\"]\").parentNode;\r\n                item.folder.displayName = folder.querySelector('DisplayName').textContent;\r\n                matches.push({\r\n                    message: {\r\n                        Id: item.itemId.id,\r\n                        BodyPreview: item.body,\r\n                        Sender: item.from,\r\n                        ToRecipients: item.to,\r\n                        ParentFolderId: item.folder.folderId.id\r\n                    },\r\n                    folder: {\r\n                        Id: item.folder.folderId.id,\r\n                        DisplayName: item.folder.displayName\r\n                    }\r\n                });\r\n            });\r\n            console.log(\"Finished loading items in other folders: \" + matches.length);\r\n            this.onLoadComplete(Model_1.Data.removeDuplicates(matches, this.itemId, this.excludedFolders.map(function (value) { return value.folderId.id; })));\r\n        };\r\n        Context.prototype.moveItems = function (folderId, onMoveComplete, onError) {\r\n            var _this = this;\r\n            this.onMoveComplete = onMoveComplete;\r\n            this.onError = onError;\r\n            console.log(\"Moving items to folder: \" + folderId);\r\n            this.mailbox.makeEwsRequestAsync(RequestBuilder.moveItemsRequest(this.conversation.items, folderId), function (result) {\r\n                if (!result.value) {\r\n                    _this.onError(result.error.message);\r\n                    return;\r\n                }\r\n                console.log(\"Finished moving items to other folder: \" + _this.conversation.items.length);\r\n                _this.onMoveComplete(_this.conversation.items.length);\r\n            });\r\n        };\r\n        return Context;\r\n    }());\r\n    var Model = /** @class */ (function () {\r\n        function Model(mailbox) {\r\n            this.context = new Context(mailbox);\r\n        }\r\n        Model.prototype.getItemsAsync = function (onLoadComplete, onProgress, onError) {\r\n            this.context.loadItems(onLoadComplete, onProgress, onError);\r\n        };\r\n        Model.prototype.moveItemsAsync = function (folderId, onMoveComplete, onError) {\r\n            this.context.moveItems(folderId, onMoveComplete, onError);\r\n        };\r\n        return Model;\r\n    }());\r\n    EWSData.Model = Model;\r\n})(EWSData = exports.EWSData || (exports.EWSData = {}));\r\n\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// functions.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 218);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 808c2a6c18e953c4daac","export module Data {\r\n    export interface Mailbox {\r\n        restUrl?: string;\r\n        diagnostics?: Office.Diagnostics;\r\n        item?: Office.Item;\r\n\r\n        convertToRestId?: (itemId: string, restVersion: Office.MailboxEnums.RestVersion) => string;\r\n        getCallbackTokenAsync?: (options: { isRest: boolean }, callback?: (result: Office.AsyncResult) => void, userContext?: any) => void;\r\n        makeEwsRequestAsync?: (data: any, callback?: (result: Office.AsyncResult) => void, userContext?: any) => void;\r\n    }\r\n\r\n    export interface Message {\r\n        Id: string;\r\n        BodyPreview: string;\r\n        Sender: string;\r\n        ToRecipients: string;\r\n        ParentFolderId: string;\r\n    }\r\n\r\n    export interface Folder {\r\n        Id: string;\r\n        DisplayName: string;\r\n    }\r\n\r\n    export interface Match {\r\n        message: Message;\r\n        folder: Folder;\r\n    }\r\n\r\n    export enum Progress {\r\n        GetCallbackToken,\r\n        GetConversation,\r\n        GetExcludedFolders,\r\n        GetFolderNames,\r\n        Success,\r\n        NotFound,\r\n        Error\r\n    }\r\n\r\n    export interface IModel {\r\n        getItemsAsync(onLoadComplete: (results: Match[]) => void, onProgress: (progress: Progress) => void, onError: (message: string) => void): void;\r\n        moveItemsAsync(folderId: string, onMoveComplete: (count: number) => void, onError: (message: string) => void): void;\r\n    }\r\n\r\n    export function removeDuplicates(results: Match[], itemId: string, excludedFolderIds: string[]) {\r\n        if (itemId) {\r\n            const item = results\r\n                .filter(item => item.message.Id === itemId)\r\n                .pop();\r\n\r\n            if (item) {\r\n                console.log(`Removing duplicates: ${results.length} original message(s)`);\r\n\r\n                // Find all of the items in the same folder, we want to remove all of their duplicates.\r\n                const sameFolderItems = results.filter(result => result.message.ParentFolderId === item.message.ParentFolderId);\r\n\r\n                console.log(`Messages in the same folder: ${sameFolderItems.length} message(s)`);\r\n\r\n                // Remove all items that are in the same folder.\r\n                results = results.filter(result => {\r\n                    if (result.folder.Id === item.message.ParentFolderId) {\r\n                        console.log(`Removed message in the same folder: ${result.message.Id}`);\r\n                        return false;\r\n                    } else {\r\n                        return true;\r\n                    }\r\n                });\r\n\r\n                // Remove all items that are in another excluded folder.\r\n                results = results.filter(result => {\r\n                    if (excludedFolderIds.reduce((previousValue, currentValue) => previousValue || currentValue === result.folder.Id, false)) {\r\n                        console.log(`Removed message in an excluded folder: ${result.message.Id}`);\r\n                        return false;\r\n                    } else {\r\n                        return true;\r\n                    }\r\n                });\r\n\r\n                // Remove all items that match an item in the same folder.\r\n                results = results.filter(result => {\r\n                    if (sameFolderItems.reduce((previousValue, value) => previousValue ||\r\n                        (result.message.Sender === value.message.Sender &&\r\n                            result.message.ToRecipients === value.message.ToRecipients &&\r\n                            result.message.BodyPreview === value.message.BodyPreview), false)) {\r\n                        console.log(`Removed duplicate message in other folder: ${item.message.Id}`);\r\n                        return false;\r\n                    } else {\r\n                        return true;\r\n                    }\r\n                });\r\n\r\n                console.log(`Remaining in other folders: ${results.length} distinct message(s)`);\r\n            }\r\n        }\r\n\r\n        return results;\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Data/Model.ts","import { Data } from \"./Data/Model\";\r\n\r\nexport module DialogMessages {\r\n    const storageKey = \"conversationFilerMatches\";\r\n\r\n    export function saveDialog(storedResults: Data.Match[]) {\r\n        window.localStorage.setItem(storageKey, JSON.stringify(storedResults));\r\n    }\r\n\r\n    export function loadDialog() {\r\n        return JSON.parse(window.localStorage.getItem(storageKey)) as Data.Match[];\r\n    }\r\n\r\n    export function resetDialog() {\r\n        window.localStorage.removeItem(storageKey);\r\n    }\r\n\r\n    export interface FileDialogMessage {\r\n        canceled: boolean;\r\n        folderId?: string;\r\n    }\r\n\r\n    export interface AboutDialogMessage {\r\n        canceled: boolean;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/messages.ts","import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\n\r\nimport { DialogMessages } from \"./messages\";\r\n\r\nimport { Data } from \"./Data/Model\";\r\nimport { Factory } from \"./Data/Factory\";\r\n\r\nimport { ConversationFilerDialog } from \"./components/ConversationFilerDialog\";\r\n\r\nmodule ButtonFunctions {\r\n    const functionsRegex = /\\/functions\\.html(\\?.*)?$/i;\r\n\r\n    function getDialogUrl(): string {\r\n        return window.location.href.replace(functionsRegex, \"/dialog.html\");\r\n    }\r\n\r\n    function getAboutUrl(): string {\r\n        return window.location.href.replace(functionsRegex, \"/about.html\");\r\n    }\r\n\r\n    export function fileDialog(event: any) {\r\n        const mailbox = Office.context.mailbox;\r\n        const data = Factory.getData(<any>mailbox);\r\n        const notificationKey = 'conversationFilerNotification';\r\n\r\n        console.log('Starting to load the conversation...');\r\n\r\n        data.getItemsAsync((results) => {\r\n            console.log(`Loaded the conversation: ${results.length}`);\r\n\r\n            if (results.length === 0) {\r\n                // Special case for empty results\r\n                mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                    type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\r\n                    message: `It looks like you haven't filed this conversation anywhere before.`,\r\n                    icon: 'file-icon-16',\r\n                    persistent: false\r\n                });\r\n                event.completed();\r\n\r\n                return;\r\n            }\r\n\r\n            console.log('Showing the dialog...');\r\n\r\n            mailbox.item.notificationMessages.removeAsync(notificationKey);\r\n            DialogMessages.saveDialog(results);\r\n            Office.context.ui.displayDialogAsync(getDialogUrl(), { height: 40, width: 50, displayInIframe: true }, (result) => {\r\n                const dialog = <Office.DialogHandler>result.value;\r\n                const onDialogComplete = () => {\r\n                    DialogMessages.resetDialog();\r\n                    event.completed();\r\n                };\r\n\r\n                dialog.addEventHandler(Office.EventType.DialogMessageReceived, (dialogEvent: { message: string }) => {\r\n                    const message = <DialogMessages.FileDialogMessage>JSON.parse(dialogEvent.message);\r\n\r\n                    if (message.canceled) {\r\n                        console.log('Dialog canceled');\r\n\r\n                        dialog.close();\r\n                        onDialogComplete();\r\n                        return;\r\n                    }\r\n\r\n                    console.log('Moving the items...');\r\n\r\n                    dialog.close();\r\n                    mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                        type: Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,\r\n                        message: 'Moving the items in this conversation...'\r\n                    });\r\n\r\n                    data.moveItemsAsync(message.folderId, (count) => {\r\n                        console.log(`Finished moving the items: ${count}`);\r\n\r\n                        mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                            type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,\r\n                            message: 'I moved the items in this conversation, but there might be a short delay before that shows up in Outlook.',\r\n                            icon: 'file-icon-16',\r\n                            persistent: false\r\n                        });\r\n\r\n                        onDialogComplete();\r\n                    }, (message) => {\r\n                        console.log(`Error moving the items: ${message}`);\r\n\r\n                        mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                            type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n                            message: `Something went wrong, I couldn't move the messages.`\r\n                        });\r\n                        onDialogComplete();\r\n                    });\r\n                });\r\n\r\n                dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\r\n                    onDialogComplete();\r\n                });\r\n            });\r\n        }, (progress) => {\r\n            console.log(`Progress loading the conversation: ${Data.Progress[progress]}`);\r\n\r\n            // Update the progress indicator\r\n            mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                type: Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,\r\n                message: 'Finding the messages in this conversation...'\r\n            });\r\n        }, (message) => {\r\n            console.log(`Error loading the conversation: ${message}`);\r\n\r\n            // Display an error\r\n            mailbox.item.notificationMessages.replaceAsync(notificationKey, {\r\n                type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,\r\n                message: `Sorry, I couldn't figure out where this message should go.`\r\n            });\r\n\r\n            event.completed();\r\n        });\r\n    }\r\n\r\n    export function aboutDialog(event: any) {\r\n        Office.context.ui.displayDialogAsync(getAboutUrl(), { height: 40, width: 25, displayInIframe: true }, (result) => {\r\n            const dialog = <Office.DialogHandler>result.value;\r\n            const onDialogComplete = () => {\r\n                event.completed();\r\n            };\r\n\r\n            dialog.addEventHandler(Office.EventType.DialogMessageReceived, () => {\r\n                console.log('Dialog closed with button');\r\n\r\n                dialog.close();\r\n                event.completed();\r\n            });\r\n\r\n            dialog.addEventHandler(Office.EventType.DialogEventReceived, () => {\r\n                console.log('Dialog closed');\r\n\r\n                event.completed();\r\n            });\r\n        });\r\n    }\r\n\r\n    export function sendFeedback(event: any) {\r\n        Office.context.mailbox.displayNewMessageForm({\r\n            toRecipients: [ 'wravery@hotmail.com' ],\r\n            subject: 'Conversation Filer v2.0 App for Outlook'\r\n        });\r\n\r\n        event.completed();\r\n    }\r\n}\r\n\r\nOffice.initialize = function () {\r\n    // Add the UI-less function callbacks to the window\r\n    (<any>window).fileDialog = ButtonFunctions.fileDialog;\r\n    (<any>window).aboutDialog = ButtonFunctions.aboutDialog;\r\n    (<any>window).sendFeedback = ButtonFunctions.sendFeedback;\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/functions.ts","import { Data } from \"./Model\";\r\nimport { RESTData } from \"./RESTData\";\r\nimport { EWSData } from \"./EWSData\";\r\n\r\nexport module Factory {\r\n    // Use the RESTData provider if possible, but if it's not supported, fallback to the EWSData provider\r\n    export function getData(mailbox: Data.Mailbox): Data.IModel {\r\n        return mailbox.restUrl\r\n            ? new RESTData.Model(mailbox)\r\n            : new EWSData.Model(mailbox);\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Data/Factory.ts","import { Data } from \"./Model\";\r\n\r\nexport module RESTData {\r\n    const Endpoint = '/v2.0/me';\r\n\r\n    enum ExcludedFolders {\r\n        Inbox,\r\n        Drafts,\r\n        SentItems,\r\n        DeletedItems,\r\n\r\n        // Sentinel value for enumerating the folder names\r\n        Count\r\n    }\r\n\r\n    interface EmailAddressJson {\r\n        Name: string;\r\n        Address: string;\r\n    }\r\n\r\n    interface AddressJson {\r\n        EmailAddress: EmailAddressJson;\r\n    }\r\n\r\n    interface MessageJson {\r\n        Id: string;\r\n        BodyPreview: string;\r\n        Sender: AddressJson;\r\n        ToRecipients: AddressJson[];\r\n        ParentFolderId: string;\r\n    }\r\n\r\n    interface MessageJsonCollection {\r\n        value: MessageJson[];\r\n    }\r\n\r\n    interface FolderJson {\r\n        Id: string;\r\n        DisplayName?: string;\r\n    }\r\n\r\n    class Context {\r\n        constructor(private mailbox: Data.Mailbox) {\r\n            this.itemId = this.getRestId((<Office.ItemRead>this.mailbox.item).itemId);\r\n        }\r\n\r\n        private itemId: string;\r\n        private token?: string;\r\n        private currentFolderId?: string;\r\n        private conversationMessages?: MessageJson[];\r\n        private excludedFolderIds?: string[];\r\n\r\n        private onLoadComplete?: (results: Data.Match[]) => void;\r\n        private onProgress?: (progress: Data.Progress) => void;\r\n        private onError?: (message: string) => void;\r\n        private onMoveComplete?: (count: number) => void\r\n\r\n        loadItems(onLoadComplete: (results: Data.Match[]) => void, onProgress: (progress: Data.Progress) => void, onError: (message: string) => void): void {\r\n            this.onLoadComplete = onLoadComplete;\r\n            this.onProgress = onProgress;\r\n            this.onError = onError;\r\n\r\n            console.log('Requesting the REST callback token...');\r\n            this.onProgress(Data.Progress.GetCallbackToken);\r\n\r\n            // Start the chain of requests by getting a callback token.\r\n            this.mailbox.getCallbackTokenAsync({ isRest: true },\r\n                (result: Office.AsyncResult) => {\r\n                    if (result.status === Office.AsyncResultStatus.Succeeded) {\r\n                        this.getConversation(result);\r\n                    } else {\r\n                        this.onError(result.error.message);\r\n                    }\r\n                });\r\n        }\r\n\r\n        // Sometimes we need to make separate REST requests for multiple items. Wait until they all complete and then\r\n        // invoke the callbacks all at once with an array of typed results.\r\n        private collateRequests<T>(requests: JQuery.jqXHR<T>[], onDone: (results: T[]) => void, onFail: (message: string) => void): void {\r\n            if (requests.length > 1) {\r\n                $.when.apply($, requests)\r\n                    .done((...results: any[]) => {\r\n                        onDone(results.map(result => <T>result[0]));\r\n                    }).fail((request: JQuery.jqXHR, status: JQuery.Ajax.ErrorTextStatus, message: string) => {\r\n                        this.onError(message);\r\n                    });\r\n            } else {\r\n                requests[0]\r\n                    .done((result: T) => {\r\n                        onDone([result]);\r\n                    }).fail((request: JQuery.jqXHR, status: JQuery.Ajax.ErrorTextStatus, message: string) => {\r\n                        this.onError(message);\r\n                    });\r\n            }\r\n        }\r\n\r\n        // If we're on iOS, the IDs we get from Office.context.mailbox.item are already REST IDs. Otherwise we need\r\n        // to convert them from the EWS ID format to the REST ID format.\r\n        private getRestId(itemId: string) {\r\n            if (this.mailbox.diagnostics.hostName === 'OutlookIOS') {\r\n                return itemId;\r\n            }\r\n\r\n            return this.mailbox.convertToRestId(itemId, Office.MailboxEnums.RestVersion.v2_0);\r\n        }\r\n\r\n        // Send a REST request to retrieve a list of messages in this conversation.\r\n        private getConversation(result: Office.AsyncResult) {\r\n            this.token = <string>result.value;\r\n\r\n            const conversationId = (<Office.Message>this.mailbox.item).conversationId;\r\n            const restConversationId = this.getRestId(conversationId);\r\n            const restUrl = `${this.mailbox.restUrl}${Endpoint}/messages?$filter=ConversationId eq '${restConversationId}'&$select=Id,Subject,BodyPreview,Sender,ToRecipients,ParentFolderId`;\r\n\r\n            console.log(`Getting the list of items in the conversation: ${restUrl}`);\r\n            this.onProgress(Data.Progress.GetConversation);\r\n\r\n            $.ajax({\r\n                url: restUrl,\r\n                async: true,\r\n                dataType: 'json',\r\n                headers: { 'Authorization': `Bearer ${this.token}` }\r\n            }).done((result: MessageJsonCollection) => {\r\n                this.getExcludedFolders(result);\r\n            }).fail((request: JQuery.jqXHR, status: JQuery.Ajax.ErrorTextStatus, message: string) => {\r\n                this.onError(message);\r\n            });\r\n        }\r\n\r\n        // Send a REST request to identify each of the folders we want to exclude in our results.\r\n        private getExcludedFolders(result: MessageJsonCollection) {\r\n            if (!result || !result.value || 0 === result.value.length) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n\r\n            this.conversationMessages = result.value;\r\n\r\n            console.log(`Messages in the conversation: ${this.conversationMessages.length}`);\r\n\r\n            // Get the current folderId.\r\n            const currentFolderId = this.conversationMessages\r\n                .filter(value => value.Id === this.itemId)\r\n                .reduce((previousValue: string, value) => value.ParentFolderId, undefined);\r\n\r\n            // We should exclude some special folders, but we need to get their folderIds.\r\n            let requests: JQuery.jqXHR<FolderJson>[] = [];\r\n\r\n            for (let i = 0; i < ExcludedFolders.Count; ++i) {\r\n                const folderId = ExcludedFolders[i];\r\n                const restUrl = `${this.mailbox.restUrl}${Endpoint}/mailfolders/${folderId}?$select=Id`;\r\n\r\n                console.log(`Getting excluded folder ID: ${restUrl}`);\r\n\r\n                requests.push($.ajax({\r\n                    url: restUrl,\r\n                    async: true,\r\n                    dataType: 'json',\r\n                    headers: { 'Authorization': `Bearer ${this.token}` }\r\n                }));\r\n            }\r\n\r\n            this.onProgress(Data.Progress.GetExcludedFolders);\r\n\r\n            this.collateRequests(requests, (results) => {\r\n                const excludedFolderIds = results.map(value => value.Id);\r\n\r\n                this.getFolderNames(currentFolderId, excludedFolderIds);\r\n            }, (message) => {\r\n                this.onError(message);\r\n            });\r\n        }\r\n\r\n        // Send REST requests to fill in the display names of all the folders we are not excluding.\r\n        private getFolderNames(currentFolderId: string, excludedFolderIds: string[]) {\r\n            interface folderMapEntry {\r\n                folder: FolderJson;\r\n                messages: MessageJson[];\r\n            };\r\n\r\n            const folderMap = this.conversationMessages\r\n                .reduce((previousValue: folderMapEntry[], message) => {\r\n                    const entry = previousValue\r\n                        .filter(value => value.folder.Id === message.ParentFolderId)\r\n                        .pop();\r\n\r\n                    if (entry) {\r\n                        // Add this message to the existing entry.\r\n                        entry.messages.push(message);\r\n                    } else {\r\n                        // Create a new entry for this folder.\r\n                        previousValue.push({ folder: { Id: message.ParentFolderId }, messages: [message] });\r\n                    }\r\n\r\n                    return previousValue;\r\n                }, []);\r\n\r\n            this.currentFolderId = currentFolderId;\r\n            this.excludedFolderIds = excludedFolderIds;\r\n\r\n            const requests: JQuery.jqXHR<FolderJson>[] = folderMap\r\n                .filter(entry => !this.excludedFolderIds.reduce((previousValue, value) =>\r\n                    previousValue || value === entry.folder.Id, false))\r\n                .map((entry) => {\r\n                    const restUrl = `${this.mailbox.restUrl}${Endpoint}/mailfolders/${entry.folder.Id}?$select=Id,DisplayName`;\r\n\r\n                    console.log(`Getting included folder name: ${restUrl}`);\r\n\r\n                    return $.ajax({\r\n                        url: restUrl,\r\n                        async: true,\r\n                        dataType: 'json',\r\n                        headers: { 'Authorization': `Bearer ${this.token}` }\r\n                    });\r\n                });\r\n\r\n            if (requests.length === 0) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n\r\n            this.onProgress(Data.Progress.GetFolderNames);\r\n\r\n            this.collateRequests(requests, (results: FolderJson[]) => {\r\n                results.forEach((value) => {\r\n                    for (let i = 0; i < folderMap.length; ++i) {\r\n                        if (folderMap[i].folder.Id === value.Id) {\r\n                            folderMap[i].folder.DisplayName = value.DisplayName;\r\n                            break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                const messageCount = folderMap.reduce((previousValue, currentValue) => previousValue + currentValue.messages.length, 0);\r\n                const folderCount = folderMap.length;\r\n\r\n                console.log(`Found ${messageCount} message(s) in ${folderCount} folder(s)`);\r\n\r\n                const matches = folderMap.reduce((previousValue: Data.Match[], currentValue) =>\r\n                    previousValue.concat(currentValue.messages.map(item => (<Data.Match>{\r\n                        message: {\r\n                            Id: item.Id,\r\n                            BodyPreview: item.BodyPreview,\r\n                            Sender: item.Sender.EmailAddress.Name,\r\n                            ToRecipients: item.ToRecipients.map(address => address.EmailAddress.Name).join('; '),\r\n                            ParentFolderId: item.ParentFolderId\r\n                        },\r\n                        folder: {\r\n                            Id: currentValue.folder.Id,\r\n                            DisplayName: currentValue.folder.DisplayName\r\n                        }\r\n                    }))), []);\r\n\r\n                console.log(`Finished loading items: ${matches.length}`);\r\n                this.onLoadComplete(Data.removeDuplicates(matches, this.itemId, this.excludedFolderIds));\r\n            }, (message: string) => {\r\n                this.onError(message);\r\n            });\r\n        }\r\n\r\n        moveItems(folderId: string, onMoveComplete: (count: number) => void, onError: (message: string) => void) {\r\n            this.onMoveComplete = onMoveComplete;\r\n            this.onError = onError;\r\n\r\n            console.log(`Moving items to folder: ${folderId}`);\r\n\r\n            const requests: JQuery.jqXHR<MessageJson>[] = this.conversationMessages\r\n                .filter(message => message.ParentFolderId !== this.currentFolderId)\r\n                .map(message => {\r\n                    const restUrl = `${this.mailbox.restUrl}${Endpoint}/messages/${message.Id}/move`;\r\n\r\n                    console.log(`Moving item: ${restUrl}`);\r\n\r\n                    return $.ajax({\r\n                        url: restUrl,\r\n                        async: true,\r\n                        method: 'POST',\r\n                        contentType: 'application/json',\r\n                        dataType: 'json',\r\n                        data: JSON.stringify({ DestinationId: folderId }),\r\n                        headers: { 'Authorization': `Bearer ${this.token}` }\r\n                    })\r\n                });\r\n\r\n            this.collateRequests(requests, (results: MessageJson[]) => {\r\n                console.log(`Finished moving items to other folder: ${results.length}`);\r\n                this.onMoveComplete(results.length);\r\n            }, (message: string) => {\r\n                this.onError(message);\r\n            });\r\n        }\r\n    }\r\n\r\n    export class Model implements Data.IModel {\r\n        private context?: Context;\r\n\r\n        constructor(mailbox: Data.Mailbox) {\r\n            this.context = new Context(mailbox);\r\n        }\r\n\r\n        getItemsAsync(onLoadComplete: (results: Data.Match[]) => void, onProgress: (progress: Data.Progress) => void, onError: (message: string) => void): void {\r\n            this.context.loadItems(onLoadComplete, onProgress, onError);\r\n        }\r\n\r\n        moveItemsAsync(folderId: string, onMoveComplete: (count: number) => void, onError: (message: string) => void): void {\r\n            this.context.moveItems(folderId, onMoveComplete, onError);\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Data/RESTData.ts","import { Data } from \"./Model\";\r\n\r\nexport module EWSData {\r\n    interface ItemId {\r\n        id: string;\r\n        changeKey: string;\r\n    }\r\n\r\n    interface FolderData {\r\n        folderId: ItemId;\r\n        displayName?: string;\r\n    }\r\n\r\n    interface MessageData {\r\n        itemId: ItemId;\r\n        conversation: ConversationData;\r\n        folder?: FolderData;\r\n        body?: string;\r\n        from?: string;\r\n        to?: string;\r\n    }\r\n\r\n    interface ConversationData {\r\n        id: string;\r\n        items: MessageData[];\r\n        global: MessageData[];\r\n    }\r\n\r\n    class RequestBuilder {\r\n        private static beginRequest = [\r\n            '<?xml version=\"1.0\" encoding=\"utf-8\" ?>',\r\n            '<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"',\r\n            '    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"',\r\n            '    xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"',\r\n            '    xmlns:t=\"http://schemas.microsoft.com/exchange/services/2006/types\"',\r\n            '    xmlns:m=\"http://schemas.microsoft.com/exchange/services/2006/messages\">',\r\n            '<soap:Header>',\r\n            '  <t:RequestServerVersion Version=\"Exchange2010_SP1\" />',\r\n            '</soap:Header>',\r\n            '<soap:Body>',\r\n        ].join('\\n');\r\n\r\n        private static endRequest = [\r\n            '</soap:Body>',\r\n            '</soap:Envelope>'\r\n        ].join('\\n');\r\n\r\n        static findConversationRequest = [\r\n            RequestBuilder.beginRequest,\r\n            '  <m:FindConversation>',\r\n            '    <m:IndexedPageItemView BasePoint=\"Beginning\" Offset=\"0\" MaxEntriesReturned=\"20\" />',\r\n            '    <m:ParentFolderId>',\r\n            '      <t:DistinguishedFolderId Id=\"inbox\"/>',\r\n            '    </m:ParentFolderId>',\r\n            '  </m:FindConversation>',\r\n            RequestBuilder.endRequest\r\n        ].join('\\n');\r\n\r\n        static getItemsRequest(messages: MessageData[]) {\r\n            var builder = [\r\n                RequestBuilder.beginRequest,\r\n                '  <m:GetItem>',\r\n                '    <m:ItemShape>',\r\n                '      <t:BaseShape>IdOnly</t:BaseShape>',\r\n                '      <t:BodyType>Text</t:BodyType>',\r\n                '      <t:AdditionalProperties>',\r\n                '        <t:FieldURI FieldURI=\"item:ParentFolderId\" />',\r\n                '        <t:FieldURI FieldURI=\"message:Sender\" />',\r\n                '        <t:FieldURI FieldURI=\"message:ToRecipients\" />',\r\n                '        <t:FieldURI FieldURI=\"item:Body\" />',\r\n                '      </t:AdditionalProperties>',\r\n                '    </m:ItemShape>',\r\n                '    <m:ItemIds>',\r\n            ];\r\n\r\n            messages.map(message => {\r\n                builder.push(`      <t:ItemId Id=\"${message.itemId.id}\" ChangeKey=\"${message.itemId.changeKey}\" />`);\r\n            });\r\n\r\n            builder.push(\r\n                '    </m:ItemIds>',\r\n                '  </m:GetItem>',\r\n                RequestBuilder.endRequest);\r\n\r\n            return builder.join('\\n');\r\n        }\r\n\r\n        static excludedFolderIdsRequest = [\r\n            RequestBuilder.beginRequest,\r\n            '  <m:GetFolder>',\r\n            '    <m:FolderShape>',\r\n            '      <t:BaseShape>IdOnly</t:BaseShape>',\r\n            '    </m:FolderShape>',\r\n            '    <m:FolderIds>',\r\n            '      <t:DistinguishedFolderId Id=\"inbox\"/>',\r\n            '      <t:DistinguishedFolderId Id=\"drafts\"/>',\r\n            '      <t:DistinguishedFolderId Id=\"sentitems\"/>',\r\n            '      <t:DistinguishedFolderId Id=\"deleteditems\"/>',\r\n            '    </m:FolderIds>',\r\n            '  </m:GetFolder >',\r\n            RequestBuilder.endRequest\r\n        ].join('\\n');\r\n\r\n        static getFolderNamesRequest(folders: FolderData[]) {\r\n            var builder = [\r\n                RequestBuilder.beginRequest,\r\n                '  <m:GetFolder>',\r\n                '    <m:FolderShape>',\r\n                '      <t:BaseShape>IdOnly</t:BaseShape>',\r\n                '      <t:AdditionalProperties>',\r\n                '        <t:FieldURI FieldURI=\"folder:DisplayName\" />',\r\n                '      </t:AdditionalProperties>',\r\n                '    </m:FolderShape>',\r\n                '    <m:FolderIds>'\r\n            ];\r\n\r\n            folders.map(folder => {\r\n                builder.push(`      <t:FolderId Id=\"${folder.folderId.id}\" ChangeKey=\"${folder.folderId.changeKey}\" />`);\r\n            });\r\n\r\n            builder.push(\r\n                '    </m:FolderIds>',\r\n                '  </m:GetFolder >',\r\n                RequestBuilder.endRequest);\r\n\r\n            return builder.join('\\n');\r\n        }\r\n\r\n        static moveItemsRequest(messages: MessageData[], folderId: string) {\r\n            var builder = [\r\n                RequestBuilder.beginRequest,\r\n                '  <m:MoveItem>',\r\n                '    <m:ToFolderId>',\r\n                '      <t:FolderId Id=\"' + folderId + '\"/>',\r\n                '    </m:ToFolderId>',\r\n                '    <m:ItemIds>',\r\n            ];\r\n\r\n            messages.map(message => {\r\n                builder.push(`      <t:ItemId Id=\"${message.itemId.id}\" ChangeKey=\"${message.itemId.changeKey}\" />`);\r\n            });\r\n\r\n            builder.push(\r\n                '    </m:ItemIds>',\r\n                '  </m:MoveItem>',\r\n                RequestBuilder.endRequest);\r\n\r\n            return builder.join('\\n');\r\n        }\r\n    }\r\n\r\n    class Context {\r\n        constructor(private mailbox: Data.Mailbox) {\r\n            this.itemId = (<Office.ItemRead>this.mailbox.item).itemId;\r\n        }\r\n\r\n        private itemId: string;\r\n        private conversationXml?: XMLDocument;\r\n        private conversation?: ConversationData;\r\n        private excludedFolders?: FolderData[];\r\n        private itemsXml?: XMLDocument;\r\n        private folderNamesXml?: XMLDocument;\r\n\r\n        private onLoadComplete?: (results: Data.Match[]) => void;\r\n        private onProgress?: (progress: Data.Progress) => void;\r\n        private onError?: (message: string) => void;\r\n        private onMoveComplete?: (count: number) => void\r\n\r\n        loadItems(onLoadComplete: (results: Data.Match[]) => void, onProgress: (progress: Data.Progress) => void, onError: (message: string) => void): void {\r\n            this.onLoadComplete = onLoadComplete;\r\n            this.onProgress = onProgress;\r\n            this.onError = onError;\r\n\r\n            console.log('Finding the conversation with EWS...');\r\n            this.onProgress(Data.Progress.GetConversation);\r\n\r\n            this.mailbox.makeEwsRequestAsync(RequestBuilder.findConversationRequest, (result) => {\r\n                if (!result.value) {\r\n                    this.onError(result.error.message);\r\n                    return;\r\n                }\r\n\r\n                this.conversationXml = $.parseXML(result.value);\r\n                this.getConversation();\r\n            });\r\n        }\r\n\r\n        private getConversation() {\r\n            const $conversation = $(this.conversationXml.querySelectorAll('Conversation > GlobalItemIds > ItemId'))\r\n                .filter(`[Id=\"${(<Office.ItemRead>this.mailbox.item).itemId}\"]`)\r\n                .parents('Conversation');\r\n\r\n            if (!$conversation.length) {\r\n                this.onError(\"This conversation isn't in your inbox's top 20.\");\r\n                return;\r\n            }\r\n\r\n            const messageCount = parseInt($conversation.find('MessageCount').text());\r\n            const globalCount = parseInt($conversation.find('GlobalMessageCount').text());\r\n\r\n            if (messageCount >= globalCount) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n\r\n            let sameFolderItemIds: ItemId[] = [];\r\n\r\n            $conversation.find('ItemIds > ItemId').each(function () {\r\n                const $this = $(this);\r\n\r\n                sameFolderItemIds.push({\r\n                    id: $this.attr('Id'),\r\n                    changeKey: $this.attr('ChangeKey')\r\n                });\r\n            });\r\n\r\n            let otherFolderItemIds: ItemId[] = [];\r\n\r\n            $conversation.find('GlobalItemIds > ItemId').each(function () {\r\n                const $this = $(this);\r\n\r\n                otherFolderItemIds.push({\r\n                    id: $this.attr('Id'),\r\n                    changeKey: $this.attr('ChangeKey')\r\n                });\r\n            });\r\n\r\n            if (!sameFolderItemIds.length || otherFolderItemIds.length <= sameFolderItemIds.length) {\r\n                this.onLoadComplete([]);\r\n                return;\r\n            }\r\n\r\n            this.conversation = {\r\n                id: (<Office.Message>this.mailbox.item).conversationId,\r\n                items: sameFolderItemIds.map(itemId => ({ itemId: itemId, conversation: this.conversation })),\r\n                global: otherFolderItemIds.map(itemId => ({ itemId: itemId, conversation: this.conversation }))\r\n            };\r\n\r\n            this.loadExcludedFolders();\r\n        }\r\n\r\n        private loadExcludedFolders() {\r\n            if (this.excludedFolders) {\r\n                this.loadMessages();\r\n            } else {\r\n                console.log('Getting the list of excluded folders');\r\n                this.onProgress(Data.Progress.GetExcludedFolders);\r\n\r\n                this.mailbox.makeEwsRequestAsync(RequestBuilder.excludedFolderIdsRequest, (result) => {\r\n                    if (!result.value) {\r\n                        this.onError(result.error.message);\r\n                        return;\r\n                    }\r\n\r\n                    let foldersXml = $.parseXML(result.value);\r\n                    let excludedFolders: FolderData[] = [];\r\n\r\n                    $(foldersXml.querySelectorAll('GetFolderResponseMessage > Folders > Folder > FolderId')).each(function () {\r\n                        var $this = $(this);\r\n                        excludedFolders.push({\r\n                            folderId: {\r\n                                id: $this.attr('Id'),\r\n                                changeKey: $this.attr('ChangeKey')\r\n                            }\r\n                        });\r\n                    });\r\n\r\n                    this.excludedFolders = excludedFolders;\r\n\r\n                    this.loadMessages();\r\n                });\r\n            }\r\n        }\r\n\r\n        private loadMessages() {\r\n            if (this.itemsXml) {\r\n                this.getMessages();\r\n            } else {\r\n                console.log(`Getting the messages in other folders: ${this.conversation.global.length}`);\r\n                this.onProgress(Data.Progress.GetConversation);\r\n\r\n                this.mailbox.makeEwsRequestAsync(RequestBuilder.getItemsRequest(this.conversation.global), (result) => {\r\n                    if (!result.value) {\r\n                        this.onError(result.error.message);\r\n                        return;\r\n                    }\r\n\r\n                    this.itemsXml = $.parseXML(result.value);\r\n                    this.getMessages();\r\n                });\r\n            }\r\n        }\r\n\r\n        private getMessages() {\r\n            let $messages = $(this.itemsXml.querySelectorAll('GetItemResponseMessage > Items > Message > ParentFolderId'))\r\n                .parent();\r\n\r\n            this.conversation.global.map(item => {\r\n                for (let i = 0; i < $messages.length; i++) {\r\n                    const msg = $messages[i];\r\n\r\n                    if (msg.querySelector(`ItemId[Id=\"${item.itemId.id}\"]`)) {\r\n                        let folderId = msg.querySelector('ParentFolderId');\r\n\r\n                        item.folder = {\r\n                            folderId: {\r\n                                id: folderId.getAttribute('Id'),\r\n                                changeKey: folderId.getAttribute('ChangeKey')\r\n                            }\r\n                        };\r\n                        item.from = msg.querySelector('Sender > Mailbox > Name').textContent;\r\n                        item.to = msg.querySelector('ToRecipients > Mailbox > Name').textContent;\r\n                        item.body = msg.querySelector('Body').textContent.slice(0, 200);\r\n                        break;\r\n                    }\r\n                }\r\n            });\r\n\r\n            this.loadFolderDisplayNames();\r\n        }\r\n\r\n        private loadFolderDisplayNames() {\r\n            if (this.folderNamesXml) {\r\n                this.getFolderDisplayNames();\r\n            } else {\r\n                let destinations: FolderData[] = [];\r\n\r\n                this.conversation.global.map(item => {\r\n                    if (item.folder) {\r\n                        destinations.push(item.folder);\r\n                    }\r\n                });\r\n\r\n                if (!destinations.length) {\r\n                    this.onLoadComplete([]);\r\n                    return;\r\n                }\r\n\r\n                console.log(`Getting the display names of the other folders: ${destinations.length}`);\r\n                this.onProgress(Data.Progress.GetFolderNames);\r\n\r\n                this.mailbox.makeEwsRequestAsync(RequestBuilder.getFolderNamesRequest(destinations), (result) => {\r\n                    if (!result.value) {\r\n                        this.onError(result.error.message);\r\n                        return;\r\n                    }\r\n\r\n                    this.folderNamesXml = $.parseXML(result.value);\r\n                    this.getFolderDisplayNames();\r\n                });\r\n            }\r\n        }\r\n\r\n        private getFolderDisplayNames() {\r\n            let matches: Data.Match[] = [];\r\n\r\n            this.conversation.global.map((item: MessageData) => {\r\n                if (!item.folder) {\r\n                    return;\r\n                }\r\n\r\n                const folder = this.folderNamesXml.querySelector(`GetFolderResponseMessage > Folders > Folder > FolderId[Id=\"${item.folder.folderId.id}\"]`).parentNode;\r\n                item.folder.displayName = (<Element>folder).querySelector('DisplayName').textContent;\r\n\r\n                matches.push({\r\n                    message: {\r\n                        Id: item.itemId.id,\r\n                        BodyPreview: item.body,\r\n                        Sender: item.from,\r\n                        ToRecipients: item.to,\r\n                        ParentFolderId: item.folder.folderId.id\r\n                    },\r\n                    folder: {\r\n                        Id: item.folder.folderId.id,\r\n                        DisplayName: item.folder.displayName\r\n                    }\r\n                });\r\n            });\r\n\r\n            console.log(`Finished loading items in other folders: ${matches.length}`);\r\n            this.onLoadComplete(Data.removeDuplicates(matches, this.itemId, this.excludedFolders.map(value => value.folderId.id)));\r\n        }\r\n\r\n        moveItems(folderId: string, onMoveComplete: (count: number) => void, onError: (message: string) => void) {\r\n            this.onMoveComplete = onMoveComplete;\r\n            this.onError = onError;\r\n\r\n            console.log(`Moving items to folder: ${folderId}`);\r\n\r\n            this.mailbox.makeEwsRequestAsync(RequestBuilder.moveItemsRequest(this.conversation.items, folderId), (result) => {\r\n                if (!result.value) {\r\n                    this.onError(result.error.message);\r\n                    return;\r\n                }\r\n\r\n                console.log(`Finished moving items to other folder: ${this.conversation.items.length}`);\r\n                this.onMoveComplete(this.conversation.items.length);\r\n            });\r\n        }\r\n    }\r\n\r\n    export class Model implements Data.IModel {\r\n        private context?: Context;\r\n\r\n        constructor(mailbox: Data.Mailbox) {\r\n            this.context = new Context(mailbox);\r\n        }\r\n\r\n        getItemsAsync(onLoadComplete: (results: Data.Match[]) => void, onProgress: (progress: Data.Progress) => void, onError: (message: string) => void): void {\r\n            this.context.loadItems(onLoadComplete, onProgress, onError);\r\n        }\r\n\r\n        moveItemsAsync(folderId: string, onMoveComplete: (count: number) => void, onError: (message: string) => void): void {\r\n            this.context.moveItems(folderId, onMoveComplete, onError);\r\n        }\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Data/EWSData.ts"],"sourceRoot":""}